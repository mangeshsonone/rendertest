<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Member Form</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #f0f2f5;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
    }
    /* Form Title */
    .form-title {
      text-align: center;
      font-weight: bold;
      font-size: 28px; /* Slightly larger */
      color: white;
      background: linear-gradient(135deg, #0a3d62, #1e6091); /* Gradient effect */
      padding: 18px;
      border-radius: 12px;
      width: 80%;
      max-width: 700px;
      box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    /* Form Container */
    .form-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 600px;
      margin-top: 20px;
      border: 2px solid #ddd;
    }
    /* Each Form Row is Full Width */
    .form-group {
      width: 100%;
      margin-bottom: 12px;
    }
    /* Inputs, Selects & Textareas */
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      border-radius: 5px;
      padding: 8px;
      border: 1px solid #ccc;
    }
    /* Inline Error Message */
    .error-inline {
      font-size: 14px;
      color: red;
      margin-top: 5px;
    }
    /* Submit Button */
    .btn-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .btn-success {
      background-color: #1877f2;
      border: none;
      padding: 10px 18px;
      font-size: 16px;
      border-radius: 5px;
    }
    .btn-success:hover {
      background-color: #1558b0;
    }
    /* Responsive Design */
    @media (max-width: 576px) {
      .form-title {
        font-size: 20px;
        padding: 10px;
        width: 90%;
      }
      .form-container {
        width: 90%;
        padding: 15px;
      }
      .btn-success {
        font-size: 14px;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>

  <h2 class="form-title">Enter Member Details</h2>

  <div class="form-container">
    <form method="post" enctype="multipart/form-data" id="member-form">
        {% csrf_token %}
    
        <!-- Personal Details -->
        <div class="form-group">
            <label for="id_name" class="fw-bold">Full Name</label>
            {{ form.name }}
        </div>
    
        <div class="form-group">
            <label for="id_middle_name" class="fw-bold">Middle Name</label>
            {{ form.middle_name }}
        </div>
    
        <div class="form-group">
            <label for="id_last_name" class="fw-bold">Last Name</label>
            {{ form.last_name }}
        </div>
    
        <div class="form-group">
            <label for="id_birth_date" class="fw-bold">Birth Date</label>
            {{ form.birth_date }}
        </div>
    
        <div class="form-group">
            <label for="id_age" class="fw-bold">Age</label>
            {{ form.age }}
        </div>
    
        <div class="form-group">
            <label for="id_gender" class="fw-bold">Gender</label>
            {{ form.gender }}
        </div>
    
        <div class="form-group">
            <label for="id_marital_status" class="fw-bold">Marital Status</label>
            {{ form.marital_status }}
        </div>
    
        <div class="form-group">
            <label for="id_relation_with_family_head" class="fw-bold">Relation with the Head of the Family</label>
            {{ form.relation_with_family_head }}
        </div>

        <!-- Professional Details -->
        <div class="form-group">
          <label for="id_qualification" class="fw-bold">Qualification</label>
          {{ form.qualification }}
      </div>
  
      <div class="form-group">
          <label for="id_occupation" class="fw-bold">Occupation</label>
          {{ form.occupation }}
      </div>
  
      <div class="form-group">
          <label for="id_exact_nature_of_duties" class="fw-bold">Nature of Duties</label>
          {{ form.exact_nature_of_duties }}
      </div>
    
        <!-- Contact Details -->
        <div class="form-group">
          <label for="id_phone_no" class="form-label fw-bold">Phone Number</label>
          <div class="input-group">
            <span class="input-group-text">+91</span>
            <input type="text" name="phone_no" id="id_phone_no" class="form-control" placeholder="Enter 10-digit Phone Number" oninput="validatePhoneNumbers()">
          </div>
          <div id="phone-error" class="text-danger"></div>
        </div>
    
        <div class="form-group">
          <label for="id_alternative_no" class="form-label fw-bold">Alternative Number</label>
          <div class="input-group">
            <span class="input-group-text">+91</span>
          <input type="text" name="alternative_no" id="id_alternative_no" class="form-control" placeholder="Enter 10-digit Alternative Number" oninput="validatePhoneNumbers()">
        </div>
          <div id="alt-error" class="text-danger"></div>
        </div>
    
        <div class="form-group">
            <label for="id_landline_no" class="fw-bold">Landline Number</label>
            {{ form.landline_no }}
        </div>
    
        <div class="form-group">
            <label for="id_email_id" class="fw-bold">Email</label>
            {{ form.email_id }}
        </div>
    
        <!-- Address Section -->
       
      
      <div class="form-group">
          <label for="id_building_name" class="form-label fw-bold">Building Name</label>
          {{ form.building_name }}
      </div>
      
      <div class="form-group">
          <label for="id_flat_no" class="form-label fw-bold">Flat No</label>
          {{ form.flat_no }}
      </div>
      
      <div class="form-group">
          <label for="id_door_no" class="form-label fw-bold">Door No</label>
          {{ form.door_no }}
      </div>
      
      <div class="form-group">
          <label for="id_street_name" class="form-label fw-bold">Street Name</label>
          {{ form.street_name }}
      </div>
      
      <div class="form-group">
          <label for="id_landmark" class="form-label fw-bold">Landmark</label>
          {{ form.landmark }}
      </div>

      <div class="form-group">
    <label for="district" class="form-label fw-bold">District</label>
    <input type="text" id="district" name="district" class="form-control" >
</div>

<div class="form-group">
  <label for="id_pincode" class="form-label fw-bold">Pincode</label>
  {{ form.pincode }}
</div>

  <div class="form-group">
    <label for="state" class="form-label fw-bold" >State</label>
    <input type="text" id="state" name="state" class="form-control" >
</div>



<div class="form-group">
  <label for="id_country" class="form-label fw-bold">Country</label>
  {{ form.country }}
</div>
      
<div class="form-group">
  <label class="form-label fw-bold">Native Place</label>
  <div class="row">
    <div class="col">
      <input type="text" id="id_native_city" name="native_city" class="form-control" placeholder="City">
    </div>
    <div class="col">
      <input type="text" id="id_native_state" name="native_state" class="form-control" placeholder="State">
    </div>
  </div>
</div>
       
       
    
        <!-- Medical Details -->
        <div class="form-group">
            <label for="id_blood_group" class="fw-bold">Blood Group</label>
            {{ form.blood_group }}
        </div>
    
        <div class="form-group">
            <label for="id_social_media_link" class="fw-bold">Social Media Link</label>
            {{ form.social_media_link }}
        </div>
    
        <div class="form-group">
            <label for="id_photo_upload" class="fw-bold">Upload Photo</label>
            {{ form.photo_upload }}
        </div>
    
        <div class="btn-container">
            <button type="submit" class="btn btn-success px-4">Submit</button>
        </div>
    </form>
    
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Define an array of dropdown IDs and their respective placeholder text
      const dropdowns = [
        { id: "id_age", placeholder: "Select Age" },
        { id: "id_gender", placeholder: "Select Gender" },
        { id: "id_marital_status", placeholder: "Select Marital Status" },
        { id: "id_blood_group", placeholder: "Select Blood Group" },
        { id: "id_samaj", placeholder: "Select Samaj" },
        { id: "id_relation_with_family_head", placeholder: "Select Relation" }
      ];
  
      // Loop through each dropdown and update the first option text
      dropdowns.forEach(dropdown => {
        let element = document.getElementById(dropdown.id);
        if (element && element.options.length > 0) {
          element.options[0].text = dropdown.placeholder;
        }
      });
  
      

      const birthDateInput = document.getElementById("id_birth_date");
      const ageInput = document.getElementById("id_age");
      if(birthDateInput && ageInput) {
        birthDateInput.addEventListener("change", function() {
          let birthDate = new Date(this.value);
          let today = new Date();
          let age = today.getFullYear() - birthDate.getFullYear();
          let m = today.getMonth() - birthDate.getMonth();
          if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
          }
          ageInput.value = age;
        });
      }

    });
    function validatePhoneNumbers() {
      const phoneInput = document.getElementById("id_phone_no");
      const altInput = document.getElementById("id_alternative_no");
      const phoneError = document.getElementById("phone-error");
      const altError = document.getElementById("alt-error");

      let phoneValue = phoneInput.value.replace(/\D/g, ""); // Remove non-numeric characters
      let altValue = altInput.value.replace(/\D/g, ""); // Remove non-numeric characters

      phoneInput.value = phoneValue;
      altInput.value = altValue;

      // Validation for phone number - always show error unless exactly 10 digits
      if (phoneValue.length === 0) {
        phoneError.textContent = "Please enter a 10-digit phone number.";
      } else if (phoneValue.length < 10) {
        phoneError.textContent = "Number must be exactly 10 digits. You have entered " + phoneValue.length + " digits.";
      } else if (phoneValue.length > 10) {
        phoneError.textContent = "Only 10 digits are allowed. Please remove " + (phoneValue.length - 10) + " digits.";
      } else {
        phoneError.textContent = ""; // Valid 10-digit number
      }

      // Validation for alternative number - always show error unless exactly 10 digits
      if (altValue.length === 0) {
        altError.textContent = "Please enter a 10-digit alternative number.";
      } else if (altValue.length < 10) {
        altError.textContent = "Number must be exactly 10 digits. You have entered " + altValue.length + " digits.";
      } else if (altValue.length > 10) {
        altError.textContent = "Only 10 digits are allowed. Please remove " + (altValue.length - 10) + " digits.";
      } else {
        altError.textContent = ""; // Valid 10-digit number
      }

      // Check if both numbers are the same (only if both have valid 10 digits)
      if (phoneValue.length === 10 && altValue.length === 10 && phoneValue === altValue) {
        altError.textContent = "Phone number and alternative number cannot be the same.";
      }
    }

    document.getElementById('state').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];  // Get the selected `<option>`
    const stateId = selectedOption.getAttribute('data-id');   // Fetch `data-id` attribute
    const districtDropdown = document.getElementById('district');

    console.log("Selected State Name:", this.value); // State name
    console.log("Selected State ID:", stateId); // State ID

    // Clear current options
    districtDropdown.innerHTML = '<option value="">Select District</option>';
    
    if (stateId) {
        // Fetch districts for the selected state
        fetch(`/get_districts/${stateId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.districts) {
                    // Add each district to the dropdown
                    data.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.textContent = district.name;
                        districtDropdown.appendChild(option);
                    });
                } else if (data.error) {
                    console.error('Error fetching districts:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
});

document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");

    function autoSave() {
        let formData = new FormData(form);

        fetch("{% url 'save_form_data' %}", {  // Replace with your actual URL name
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
            },
        })
        .then(response => response.json())
        .then(data => console.log("Auto-saved:", data))
        .catch(error => console.error("Auto-save error:", error));
    }

    // Trigger auto-save on every input change
    form.querySelectorAll("input, select, textarea").forEach((field) => {
        field.addEventListener("input", autoSave);
        field.addEventListener("change", autoSave); // For dropdowns and checkboxes
    });
});

document.addEventListener("DOMContentLoaded", function() {
    const birthDateInput = document.getElementById("id_birth_date");

    // Create an error element if not present and insert it after the birth date field
    let errorDiv = document.getElementById("birthDateError");
    if (!errorDiv) {
        errorDiv = document.createElement("div");
        errorDiv.id = "birthDateError";
        errorDiv.className = "text-danger";
        birthDateInput.parentElement.appendChild(errorDiv);
    }

    birthDateInput.addEventListener("change", function() {
        // Parse the date input value into a Date object
        const selectedDate = new Date(birthDateInput.value);
        const today = new Date();
        // Set the time to midnight for a proper comparison
        today.setHours(0, 0, 0, 0);

        if (selectedDate > today) {
            errorDiv.textContent = "Birthdate cannot be a future date.";
        } else {
            errorDiv.textContent = "";
        }
    });
});

  </script>

</body>
</html>
